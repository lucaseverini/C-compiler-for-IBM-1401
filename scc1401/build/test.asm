     ****************************************************************

     READ      EQU  001                * Read area
     PUNCH     EQU  101                * Punch area
     PRINT     EQU  201                * Print area
     
     PRCPOS    DCW  000                * char position in print area
     PUCPOS    DCW  000                * char position in punch area
     PUNSIZ    DCW  @080@              * Size of punch area
     PRTSIZ    DCW  @132@              * Size of print area
     EOS       DCW  @'@                * End Of String char (string terminator)
     EOL       DCW  @;@                * End Of Line char

               ORG  87
     X1        DSA  0                  * INDEX REGISTER 1
               ORG  92
     X2        DSA  0                  * INDEX REGISTER 2
               ORG  97
     X3        DSA  0                  * INDEX REGISTER 3
     
     * I need a single digit flag - should I replace this with a DA?
     RF        EQU  150

               ORG  6000
  
     START     NOP
     
     ****************************************************************  
     
               SBR  X2, 400            * SET THE STACK
               MCW  X2, X3
               SW   1001
               MCW  @201@,1003
               SW   1004
               MCW  @200@,1006
               SW   1013
               MCW  @081@,1015
               SW   1034
               MCW  EOS,1034
               SW   1033
               MCW  @F@,1033
               SW   1032
               MCW  @E@,1032
               SW   1031
               MCW  @D@,1031
               SW   1030
               MCW  @C@,1030
               SW   1029
               MCW  @B@,1029
               SW   1028
               MCW  @A@,1028
               SW   1027
               MCW  @9@,1027
               SW   1026
               MCW  @8@,1026
               SW   1025
               MCW  @7@,1025
               SW   1024
               MCW  @6@,1024
               SW   1023
               MCW  @5@,1023
               SW   1022
               MCW  @4@,1022
               SW   1021
               MCW  @3@,1021
               SW   1020
               MCW  @2@,1020
               SW   1019
               MCW  @1@,1019
               SW   1018
               MCW  @0@,1018
               SW   1038
               MCW  EOS,1038
               SW   1037
               MCW  EOL,1037
               SW   1036
               MCW  @D@,1036
               SW   1035
               MCW  @%@,1035
               B    LRBAAA
               H    
     LBAAAA    SBR  3+X3
               SW   1+X3
               MA   @003@,X2
     * Push(15997+X3:1)
               SW   1+X2
               MA   @001@,X2
               MCW  15997+X3,0+X2
     * Push(EOL:1)
               SW   1+X2
               MA   @001@,X2
               MCW  EOL,0+X2
               C    0+X2,15999+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Push(@00001@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00001@,0+X2
               BE   LVBAAA
               B    LWBAAA
     LVBAAA    MCW  @00000@,0+X2
     LWBAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LTBAAA,5+X2, 
     * Push(15997+X3:1)
               SW   1+X2
               MA   @001@,X2
               MCW  15997+X3,0+X2
     * Push(@'03@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @'03@,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:3)
               SW   1+X2
               MA   @003@,X2
               MCW  0+X1,0+X2
               MA   @001@,0+X1
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:1)
               MCW  0+X2,0+X1
               MA   @I9I@,X2
               CW   1+X2
     LDAAAA    NOP  
               BCE  LCAAAA,RF,R
               B    LUBAAA
     LTBAAA    NOP  
     LXBAAA    NOP  
     * Push(1006:3)
               SW   1+X2
               MA   @003@,X2
               MCW  1006,0+X2
               B    LZBAAA
               B    LICAAA
     * Push(1003:3)
               SW   1+X2
               MA   @003@,X2
               MCW  1003,0+X2
               B    LZBAAA
               B    LICAAA
               C    0+X2,15995+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               MCW  @00001@,0+X2
               BL   LKCAAA
               B    LLCAAA
     LKCAAA    MCW  @00000@,0+X2
     LLCAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LYBAAA,5+X2, 
     * Push(@ @:1)
               SW   1+X2
               MA   @001@,X2
               MCW  @ @,0+X2
     * Push(@'06@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @'06@,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:3)
               SW   1+X2
               MA   @003@,X2
               MCW  0+X1,0+X2
               MA   @I9I@,0+X1
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:1)
               MCW  0+X2,0+X1
               MA   @I9I@,X2
               CW   1+X2
     LFAAAA    NOP  
               BCE  LEAAAA,RF,R
               B    LXBAAA
     LYBAAA    NOP  
     * Push(1003:3)
               SW   1+X2
               MA   @003@,X2
               MCW  1003,0+X2
     * Push(@'06@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @'06@,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:3)
               MCW  0+X2,0+X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(@201@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @201@,0+X2
     * Push(@'03@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @'03@,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:3)
               MCW  0+X2,0+X1
               MA   @I9G@,X2
               CW   1+X2
     * Start asm block
               W    
     * End asm block
     LEAAAA    NOP  
               BCE  LCAAAA,RF,R
     LUBAAA    NOP  
     * Push(1003:3)
               SW   1+X2
               MA   @003@,X2
               MCW  1003,0+X2
     * Push(@333@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @333@,0+X2
               C    0+X2,15997+X2
     * Pop(3)
               MA   @I9G@,X2
               CW   1+X2
     * Pop(3)
               MA   @I9G@,X2
               CW   1+X2
     * Push(@00000@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00000@,0+X2
               BE   LNCAAA
               B    LOCAAA
     LNCAAA    MCW  @00001@,0+X2
     LOCAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LMCAAA,5+X2, 
     * Push(1003:3)
               SW   1+X2
               MA   @003@,X2
               MCW  1003,0+X2
     * Push(@'06@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @'06@,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:3)
               MCW  0+X2,0+X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(@201@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @201@,0+X2
     * Push(@'03@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @'03@,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:3)
               MCW  0+X2,0+X1
               MA   @I9G@,X2
               CW   1+X2
     * Start asm block
               W    
     * End asm block
     LGAAAA    NOP  
               BCE  LCAAAA,RF,R
     LMCAAA    NOP  
     LCAAAA    NOP  
               MA   @I9G@,X2
               CW   1+X3
               MCW  @ @,RF
               MCW  3+X3,X1
               B    0+X1
     LHAAAA    SBR  3+X3
               SW   1+X3
               MA   @003@,X2
     LPCAAA    NOP  
     * Push(15997+X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  15997+X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:1)
               SW   1+X2
               MA   @001@,X2
               MCW  0+X1,0+X2
     * Push(EOS:1)
               SW   1+X2
               MA   @001@,X2
               MCW  EOS,0+X2
               C    0+X2,15999+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Push(@00001@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00001@,0+X2
               BE   LRCAAA
               B    LSCAAA
     LRCAAA    MCW  @00000@,0+X2
     LSCAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LQCAAA,5+X2, 
     * Push(5)
               SW   1+X2
               MA   @005@,X2
     * Push(@I9G@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @I9G@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:3)
               SW   1+X2
               MA   @003@,X2
               MCW  0+X1,0+X2
               MA   @001@,0+X1
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:1)
               SW   1+X2
               MA   @001@,X2
               MCW  0+X1,0+X2
     * Push(X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  X3,0+X2
               MCW  X2,X3
               B    LBAAAA
     * Pop(X3:3)
               MCW  0+X2,X3
               MA   @I9G@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
     LJAAAA    NOP  
               BCE  LIAAAA,RF,R
               B    LPCAAA
     LQCAAA    NOP  
     LIAAAA    NOP  
               MA   @I9G@,X2
               CW   1+X3
               MCW  @ @,RF
               MCW  3+X3,X1
               B    0+X1
     LCBAAA    SBR  3+X3
               SW   1+X3
               SW   4+X3
               MCW  @0000J@,8+X3
               MA   @008@,X2
     LTCAAA    NOP  
     * Push(15997+X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  15997+X3,0+X2
     * Push(@008@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @008@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
               A    @00001@,0+X1
     * Push(0+X1:5)
               SW   1+X2
               MA   @005@,X2
               MCW  0+X1,0+X2
     * Push(15997+X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  15997+X3,0+X2
     * Push(@008@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @008@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
               A    @00001@,0+X1
     * Push(0+X1:5)
               SW   1+X2
               MA   @005@,X2
               MCW  0+X1,0+X2
     * raw index on the stack
     * Push(@00001@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00001@,0+X2
               M    15995+X2,6+X2
               SW   2+X2
               MCW  6+X2,15995+X2
               CW   2+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
     * STACK TOP IS NOW ARRAY INDEX
               B    LXCAAA
               MA   0+X2,15997+X2
     * Pop(3)
               MA   @I9G@,X2
               CW   1+X2
     * STACK top is location in array now.
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:1)
               SW   1+X2
               MA   @001@,X2
               MCW  0+X1,0+X2
     * Push(EOS:1)
               SW   1+X2
               MA   @001@,X2
               MCW  EOS,0+X2
               C    0+X2,15999+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Push(@00001@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00001@,0+X2
               BE   LVCAAA
               B    LWCAAA
     LVCAAA    MCW  @00000@,0+X2
     LWCAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LUCAAA,5+X2, 
               B    LTCAAA
     LUCAAA    NOP  
     * Push(8+X3:5)
               SW   1+X2
               MA   @005@,X2
               MCW  8+X3,0+X2
     * Pop(15994+X3:5)
               MCW  0+X2,15994+X3
               MA   @I9E@,X2
               CW   1+X2
     * set the return flag, so we know do deallocate our stack
               MCW  @R@,RF
     * and branch
               B    LDBAAA
     LDBAAA    NOP  
               MA   @I9B@,X2
               CW   1+X3
               CW   4+X3
               MCW  @ @,RF
               MCW  3+X3,X1
               B    0+X1
     LKAAAA    SBR  3+X3
               SW   1+X3
               SW   4+X3
               SW   7+X3
               MCW  @00000@,11+X3
               MA   @011@,X2
     * Start asm block
               NOP  
               NOP  
               NOP  
               NOP  
               NOP  
               NOP  
               NOP  
               NOP  
               NOP  
               NOP  
               NOP  
               NOP  
               NOP  
               NOP  
               NOP  
               NOP  
               NOP  
     * End asm block
     * Push(15997+X3:5)
               SW   1+X2
               MA   @005@,X2
               MCW  15997+X3,0+X2
               B    LICAAA
     * Push(@0000J@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @0000J@,0+X2
               B    LICAAA
               C    0+X2,15995+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               MCW  @00000@,0+X2
               BL   LFDAAA
               B    LGDAAA
     LFDAAA    MCW  @00001@,0+X2
     LGDAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LEDAAA,5+X2, 
     * Push(5)
               SW   1+X2
               MA   @005@,X2
     * Push(@-@:1)
               SW   1+X2
               MA   @001@,X2
               MCW  @-@,0+X2
     * Push(X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  X3,0+X2
               MCW  X2,X3
               B    LBAAAA
     * Pop(X3:3)
               MCW  0+X2,X3
               MA   @I9G@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
     * Push(15997+X3:5)
               SW   1+X2
               MA   @005@,X2
               MCW  15997+X3,0+X2
               ZS   0+X2
               B    LICAAA
     * Push(@I9G@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @I9G@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:5)
               MCW  0+X2,0+X1
               MA   @I9E@,X2
               CW   1+X2
     LMAAAA    NOP  
               BCE  LLAAAA,RF,R
     LEDAAA    NOP  
     * Push(@I9G@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @I9G@,0+X2
               MA   X3,0+X2
     * Push(@006@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @006@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:3)
               MCW  0+X2,0+X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(6+X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  6+X3,0+X2
     * Push(@I9F@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @I9F@,0+X2
               MA   0+X2,15997+X2
     * Pop(3)
               MA   @I9G@,X2
               CW   1+X2
     * Push(@006@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @006@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:3)
               MCW  0+X2,0+X1
               MA   @I9G@,X2
               CW   1+X2
     LHDAAA    NOP  
     * Push(@00001@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00001@,0+X2
     * Push(@006@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @006@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:3)
               SW   1+X2
               MA   @003@,X2
               MCW  0+X1,0+X2
               MA   @001@,0+X1
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:1)
               SW   1+X2
               MA   @001@,X2
               MCW  0+X1,0+X2
     * Push(@0@:1)
               SW   1+X2
               MA   @001@,X2
               MCW  @0@,0+X2
               C    0+X2,15999+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Push(@00000@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00000@,0+X2
               BE   LLDAAA
               B    LMDAAA
     LLDAAA    MCW  @00001@,0+X2
     LMDAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LJDAAA,5+X2, 
     * Push(11+X3:5)
               SW   1+X2
               MA   @005@,X2
               MCW  11+X3,0+X2
               B    LICAAA
     * Push(@00006@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00006@,0+X2
               B    LICAAA
               C    0+X2,15995+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               MCW  @00000@,0+X2
               BL   LNDAAA
               B    LODAAA
     LNDAAA    MCW  @00001@,0+X2
     LODAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LJDAAA,5+X2, 
               B    LKDAAA
     LJDAAA    MCW  @00000@,0+X2
     LKDAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LIDAAA,5+X2, 
     * Push(11+X3:5)
               SW   1+X2
               MA   @005@,X2
               MCW  11+X3,0+X2
     * Push(@00001@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00001@,0+X2
               A    0+X2,15995+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
     * Push(@011@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @011@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:5)
               MCW  0+X2,0+X1
               MA   @I9E@,X2
               CW   1+X2
     LNAAAA    NOP  
               BCE  LLAAAA,RF,R
               B    LHDAAA
     LIDAAA    NOP  
     * Push(11+X3:5)
               SW   1+X2
               MA   @005@,X2
               MCW  11+X3,0+X2
               B    LICAAA
     * Push(@00005@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00005@,0+X2
               B    LICAAA
               C    0+X2,15995+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               MCW  @00001@,0+X2
               BL   LRDAAA
               B    LSDAAA
     LRDAAA    MCW  @00000@,0+X2
     LSDAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LPDAAA,5+X2, 
     * Push(5)
               SW   1+X2
               MA   @005@,X2
     * Push(@0@:1)
               SW   1+X2
               MA   @001@,X2
               MCW  @0@,0+X2
     * Push(X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  X3,0+X2
               MCW  X2,X3
               B    LBAAAA
     * Pop(X3:3)
               MCW  0+X2,X3
               MA   @I9G@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
     LOAAAA    NOP  
               BCE  LLAAAA,RF,R
               B    LQDAAA
     LPDAAA    NOP  
     * Push(6+X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  6+X3,0+X2
     * Push(@I9I@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @I9I@,0+X2
               MA   0+X2,15997+X2
     * Pop(3)
               MA   @I9G@,X2
               CW   1+X2
     * Push(@006@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @006@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:3)
               MCW  0+X2,0+X1
               MA   @I9G@,X2
               CW   1+X2
     LTDAAA    NOP  
     * Push(@00005@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00005@,0+X2
     * Push(11+X3:5)
               SW   1+X2
               MA   @005@,X2
               MCW  11+X3,0+X2
               S    0+X2,15995+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               B    LICAAA
     * Push(@00000@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00000@,0+X2
               B    LICAAA
               C    0+X2,15995+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               MCW  @00000@,0+X2
               BH   LVDAAA
               B    LWDAAA
     LVDAAA    MCW  @00001@,0+X2
     LWDAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LUDAAA,5+X2, 
     * Push(5)
               SW   1+X2
               MA   @005@,X2
     * Push(@006@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @006@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:3)
               SW   1+X2
               MA   @003@,X2
               MCW  0+X1,0+X2
               MA   @001@,0+X1
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:1)
               SW   1+X2
               MA   @001@,X2
               MCW  0+X1,0+X2
     * Push(X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  X3,0+X2
               MCW  X2,X3
               B    LBAAAA
     * Pop(X3:3)
               MCW  0+X2,X3
               MA   @I9G@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
     * Push(@011@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @011@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
               A    @00001@,0+X1
     LQAAAA    NOP  
               BCE  LPAAAA,RF,R
               B    LTDAAA
     LUDAAA    NOP  
     LPAAAA    NOP  
               BCE  LLAAAA,RF,R
     LQDAAA    NOP  
     LLAAAA    NOP  
               MA   @I8I@,X2
               CW   1+X3
               CW   4+X3
               CW   7+X3
               MCW  @ @,RF
               MCW  3+X3,X1
               B    0+X1
     LRBAAA    SBR  3+X3
               SW   1+X3
               MA   @003@,X2
     * Push(5)
               SW   1+X2
               MA   @005@,X2
     * Push(@00052@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00052@,0+X2
               ZS   0+X2
               B    LICAAA
     * Push(@'35@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @'35@,0+X2
     * Push(X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  X3,0+X2
               MCW  X2,X3
               B    LRAAAA
     * Pop(X3:3)
               MCW  0+X2,X3
               MA   @I9G@,X2
               CW   1+X2
     * Pop(3)
               MA   @I9G@,X2
               CW   1+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
     LSBAAA    NOP  
               MA   @I9G@,X2
               CW   1+X3
               MCW  @ @,RF
               MCW  3+X3,X1
               B    0+X1
     LEBAAA    SBR  3+X3
               SW   1+X3
               MA   @003@,X2
     LXDAAA    NOP  
     * Push(@I9D@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @I9D@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:3)
               SW   1+X2
               MA   @003@,X2
               MCW  0+X1,0+X2
               MA   @001@,0+X1
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:1)
               SW   1+X2
               MA   @001@,X2
               MCW  0+X1,0+X2
     * Push(@I9G@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @I9G@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:3)
               SW   1+X2
               MA   @003@,X2
               MCW  0+X1,0+X2
               MA   @001@,0+X1
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
               MCW  0+X2,0+X1
     * Push(EOS:1)
               SW   1+X2
               MA   @001@,X2
               MCW  EOS,0+X2
               C    0+X2,15999+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Push(@00001@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00001@,0+X2
               BE   LZDAAA
               B    LAEAAA
     LZDAAA    MCW  @00000@,0+X2
     LAEAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LYDAAA,5+X2, 
               B    LXDAAA
     LYDAAA    NOP  
     LFBAAA    NOP  
               MA   @I9G@,X2
               CW   1+X3
               MCW  @ @,RF
               MCW  3+X3,X1
               B    0+X1
     LRAAAA    SBR  3+X3
               SW   1+X3
               SW   4+X3
               SW   7+X3
               MA   @007@,X2
     * Push(@I9G@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @I9G@,0+X2
               MA   X3,0+X2
     * Push(@I9G@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @I9G@,0+X2
               MA   0+X2,15997+X2
     * Pop(3)
               MA   @I9G@,X2
               CW   1+X2
     * Push(@006@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @006@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:3)
               MCW  0+X2,0+X1
               MA   @I9G@,X2
               CW   1+X2
     LBEAAA    NOP  
     * Push(@I9G@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @I9G@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:3)
               SW   1+X2
               MA   @003@,X2
               MCW  0+X1,0+X2
               MA   @001@,0+X1
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:1)
               SW   1+X2
               MA   @001@,X2
               MCW  0+X1,0+X2
     * Push(@007@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @007@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
               MCW  0+X2,0+X1
     * Push(EOS:1)
               SW   1+X2
               MA   @001@,X2
               MCW  EOS,0+X2
               C    0+X2,15999+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Push(@00001@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00001@,0+X2
               BE   LDEAAA
               B    LEEAAA
     LDEAAA    MCW  @00000@,0+X2
     LEEAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LCEAAA,5+X2, 
     * Push(7+X3:1)
               SW   1+X2
               MA   @001@,X2
               MCW  7+X3,0+X2
     * Push(@%@:1)
               SW   1+X2
               MA   @001@,X2
               MCW  @%@,0+X2
               C    0+X2,15999+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Push(@00001@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00001@,0+X2
               BE   LHEAAA
               B    LIEAAA
     LHEAAA    MCW  @00000@,0+X2
     LIEAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LFEAAA,5+X2, 
     * Push(5)
               SW   1+X2
               MA   @005@,X2
     * Push(7+X3:1)
               SW   1+X2
               MA   @001@,X2
               MCW  7+X3,0+X2
     * Push(X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  X3,0+X2
               MCW  X2,X3
               B    LBAAAA
     * Pop(X3:3)
               MCW  0+X2,X3
               MA   @I9G@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               B    LGEAAA
     LFEAAA    NOP  
     * Push(@I9G@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @I9G@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:3)
               SW   1+X2
               MA   @003@,X2
               MCW  0+X1,0+X2
               MA   @001@,0+X1
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:1)
               SW   1+X2
               MA   @001@,X2
               MCW  0+X1,0+X2
     * Push(@007@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @007@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:1)
               MCW  0+X2,0+X1
               MA   @I9I@,X2
               CW   1+X2
     * Push(7+X3:1)
               SW   1+X2
               MA   @001@,X2
               MCW  7+X3,0+X2
     * Push(@%@:1)
               SW   1+X2
               MA   @001@,X2
               MCW  @%@,0+X2
               C    0+X2,15999+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Push(@00000@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00000@,0+X2
               BE   LLEAAA
               B    LMEAAA
     LLEAAA    MCW  @00001@,0+X2
     LMEAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LJEAAA,5+X2, 
     * Push(5)
               SW   1+X2
               MA   @005@,X2
     * Push(@%@:1)
               SW   1+X2
               MA   @001@,X2
               MCW  @%@,0+X2
     * Push(X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  X3,0+X2
               MCW  X2,X3
               B    LBAAAA
     * Pop(X3:3)
               MCW  0+X2,X3
               MA   @I9G@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
     LVAAAA    NOP  
               BCE  LUAAAA,RF,R
               B    LKEAAA
     LJEAAA    NOP  
     * Push(7+X3:1)
               SW   1+X2
               MA   @001@,X2
               MCW  7+X3,0+X2
     * Push(@C@:1)
               SW   1+X2
               MA   @001@,X2
               MCW  @C@,0+X2
               C    0+X2,15999+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Push(@00000@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00000@,0+X2
               BE   LPEAAA
               B    LQEAAA
     LPEAAA    MCW  @00001@,0+X2
     LQEAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LNEAAA,5+X2, 
     * Push(5)
               SW   1+X2
               MA   @005@,X2
     * Push(@006@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @006@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:3)
               SW   1+X2
               MA   @003@,X2
               MCW  0+X1,0+X2
               MA   @I9I@,0+X1
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:1)
               SW   1+X2
               MA   @001@,X2
               MCW  0+X1,0+X2
     * Push(X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  X3,0+X2
               MCW  X2,X3
               B    LBAAAA
     * Pop(X3:3)
               MCW  0+X2,X3
               MA   @I9G@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
     LWAAAA    NOP  
               BCE  LUAAAA,RF,R
               B    LOEAAA
     LNEAAA    NOP  
     * Push(7+X3:1)
               SW   1+X2
               MA   @001@,X2
               MCW  7+X3,0+X2
     * Push(@S@:1)
               SW   1+X2
               MA   @001@,X2
               MCW  @S@,0+X2
               C    0+X2,15999+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Push(@00000@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00000@,0+X2
               BE   LTEAAA
               B    LUEAAA
     LTEAAA    MCW  @00001@,0+X2
     LUEAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LREAAA,5+X2, 
     * Push(5)
               SW   1+X2
               MA   @005@,X2
     * Push(6+X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  6+X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:3)
               SW   1+X2
               MA   @003@,X2
               MCW  0+X1,0+X2
     * Push(X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  X3,0+X2
               MCW  X2,X3
               B    LHAAAA
     * Pop(X3:3)
               MCW  0+X2,X3
               MA   @I9G@,X2
               CW   1+X2
     * Pop(3)
               MA   @I9G@,X2
               CW   1+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
     * Push(6+X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  6+X3,0+X2
     * Push(@I9G@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @I9G@,0+X2
               MA   0+X2,15997+X2
     * Pop(3)
               MA   @I9G@,X2
               CW   1+X2
     * Push(@006@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @006@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:3)
               MCW  0+X2,0+X1
               MA   @I9G@,X2
               CW   1+X2
     LXAAAA    NOP  
               BCE  LUAAAA,RF,R
               B    LSEAAA
     LREAAA    NOP  
     * Push(7+X3:1)
               SW   1+X2
               MA   @001@,X2
               MCW  7+X3,0+X2
     * Push(@D@:1)
               SW   1+X2
               MA   @001@,X2
               MCW  @D@,0+X2
               C    0+X2,15999+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Pop(1)
               MA   @I9I@,X2
               CW   1+X2
     * Push(@00000@:5)
               SW   1+X2
               MA   @005@,X2
               MCW  @00000@,0+X2
               BE   LXEAAA
               B    LYEAAA
     LXEAAA    MCW  @00001@,0+X2
     LYEAAA    NOP  
               MCS  0+X2,0+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
               BCE  LVEAAA,5+X2, 
     * Push(5)
               SW   1+X2
               MA   @005@,X2
     * Push(6+X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  6+X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Push(0+X1:5)
               SW   1+X2
               MA   @005@,X2
               MCW  0+X1,0+X2
     * Push(X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  X3,0+X2
               MCW  X2,X3
               B    LKAAAA
     * Pop(X3:3)
               MCW  0+X2,X3
               MA   @I9G@,X2
               CW   1+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
     * Pop(5)
               MA   @I9E@,X2
               CW   1+X2
     * Push(6+X3:3)
               SW   1+X2
               MA   @003@,X2
               MCW  6+X3,0+X2
     * Push(@I9E@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @I9E@,0+X2
               MA   0+X2,15997+X2
     * Pop(3)
               MA   @I9G@,X2
               CW   1+X2
     * Push(@006@:3)
               SW   1+X2
               MA   @003@,X2
               MCW  @006@,0+X2
               MA   X3,0+X2
     * Pop(X1:3)
               MCW  0+X2,X1
               MA   @I9G@,X2
               CW   1+X2
     * Pop(0+X1:3)
               MCW  0+X2,0+X1
               MA   @I9G@,X2
               CW   1+X2
     LYAAAA    NOP  
               BCE  LUAAAA,RF,R
               B    LWEAAA
     LVEAAA    NOP  
     * set the return flag, so we know do deallocate our stack
               MCW  @R@,RF
     * and branch
               B    LUAAAA
     LWEAAA    NOP  
     LSEAAA    NOP  
     LOEAAA    NOP  
     LKEAAA    NOP  
     LUAAAA    NOP  
               BCE  LTAAAA,RF,R
     LGEAAA    NOP  
     LTAAAA    NOP  
               BCE  LSAAAA,RF,R
               B    LBEAAA
     LCEAAA    NOP  
     LSAAAA    NOP  
               MA   @I9C@,X2
               CW   1+X3
               CW   4+X3
               CW   7+X3
               MCW  @ @,RF
               MCW  3+X3,X1
               B    0+X1
     LXCAAA    SBR  X1
     * Casts a 5-digit number to a 3-digit address
     * make a copy of the top of the stack
               SW   1+X2
               MCW  0+X2,3+X2
     * zero out the zone bits of our copy
               MZ   @0@,3+X2
               MZ   @0@,2+X2
               MZ   @0@,1+X2
     * set the low-order digit's zone bits
               C    @04000@,0+X2
               BL   LADAAA
               C    @08000@,0+X2
               BL   LZCAAA
               C    @12000@,0+X2
               BL   LYCAAA
               S    @12000@,0+X2
               MZ   @A@,3+X2
               B    LADAAA
     LYCAAA    S    @08000@,0+X2
               MZ   @I@,3+X2
               B    LADAAA
     LZCAAA    S    @04000@,0+X2
               MZ   @S@,3+X2
     * For some reason the zone bits get set - it still works though.
     LADAAA    C    @01000@,0+X2
               BL   LDDAAA
               C    @02000@,0+X2
               BL   LCDAAA
               C    @03000@,0+X2
               BL   LBDAAA
               MZ   @A@,1+X2
               B    LDDAAA
     LBDAAA    MZ   @I@,1+X2
               B    LDDAAA
     LCDAAA    MZ   @S@,1+X2
     LDDAAA    MCW  3+X2,15998+X2
               CW   1+X2
               SBR  X2,15998+X2
               B    0+X1
     LZBAAA    SBR  X1
     * Casts a 3-digit address to a 5-digit number
     * Make room on the stack for an int
               MA   @002@,X2
     * make a copy of the top of the stack
               SW   1+X2
               MCW  15998+X2,3+X2
     * Now zero out the top of the stack
               MCW  @00000@,0+X2
     * Now copy back, shifted over 2 digits
               MCW  3+X2,0+X2
               CW   1+X2
     * Now zero out the zone bits on the stack
               MZ   @0@,0+X2
               MZ   @0@,15999+X2
               MZ   @0@,15998+X2
     * check the high-order digit's zone bits
               BWZ  LACAAA,1+X2,S
               BWZ  LBCAAA,1+X2,K
               BWZ  LCCAAA,1+X2,B
               B    LDCAAA
     LACAAA    A    @01000@,0+X2
               B    LDCAAA
     LBCAAA    A    @02000@,0+X2
               B    LDCAAA
     LCCAAA    A    @03000@,0+X2
     LDCAAA    BWZ  LECAAA,3+X2,S
               BWZ  LFCAAA,3+X2,K
               BWZ  LGCAAA,3+X2,B
               B    LHCAAA
     LECAAA    A    @04000@,0+X2
               B    LHCAAA
     LFCAAA    A    @08000@,0+X2
               B    LHCAAA
     LGCAAA    A    @12000@,0+X2
     LHCAAA    B    0+X1
     LICAAA    SBR  X1
     * Normalizes the zone bits of a number, leaving either A=0B=0
     * for a positive or A=0B=1 for a negative
     * Do nothing on either no zone bits or only a b zone bit
               BWZ  LJCAAA,0+X2,2
               BWZ  LJCAAA,0+X2,K
     * else clear the zone bits, as it is positive
               MZ   @ @,0+X2
     LJCAAA    B    0+X1
               END  START
